
# CA 密钥及证书
openssl req -x509 -nodes -days 3650 -newkey rsa:4096 -keyout ca.key -out ca.crt -subj "/CN=ca.k8s.local"

# kube-apiserver、kube-controller-manager 及 kube-scheduler 密钥及证书
openssl req -nodes -newkey rsa:4096 -keyout master.key -out master.csr -subj "/CN=master.k8s.local"
openssl x509 -req -CAcreateserial -CA ca.crt -CAkey ca.key -days 3650 -extensions v3_req -extfile config.cnf -in master.csr -out master.crt

# kube-proxy 及 kubelet 密钥及证书
openssl req -nodes -newkey rsa:4096 -keyout node.key -out node.csr -subj "/CN=node.k8s.local"
openssl x509 -req -CAcreateserial -CA ca.crt -CAkey ca.key -days 3650 -extensions v3_req -extfile config.cnf -in node.csr -out node.crt

# kubectl 密钥及证书
openssl req -nodes -newkey rsa:4096 -keyout kubectl.key -out kubectl.csr -subj "/CN=kubectl.k8s.local"
openssl x509 -req -CAcreateserial -CA ca.crt -CAkey ca.key -days 3650 -extensions v3_req -extfile config.cnf -in kubectl.csr -out kubectl.crt



--client-ca-file=/etc/kubernetes/ssl/ca.crt --tls-cert-file=/etc/kubernetes/ssl/master.crt --tls-private-key-file=/etc/kubernetes/ssl/master.key



kubectl --server=https://172.17.0.101:6443 \
--certificate-authority=/etc/kubernetes/ssl/ca.crt \
--client-certificate=/etc/kubernetes/ssl/kubectl.crt \
--client-key=/etc/kubernetes/ssl/kubectl.key \
version


openssl x509 -text -noout -in ca.crt

openssl req -text -noout -in kubectl.csr

